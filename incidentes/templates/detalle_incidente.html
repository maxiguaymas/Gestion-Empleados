{% extends 'base.html' %}

{% block content %}
<div class="py-4 min-vh-100 row justify-content-center" id="empleados">


    <div class="card shadow mb-4 fondo-semi" id="box-det-incidente">
        <a href="{% url 'ver_incidentes' %}" class="btn btn-outline-secondary mb-3 btn-det-incid">
            <i class="fas fa-arrow-left"></i> Volver al Listado
        </a>
        <div class="card-header">
            <h2 class="card-title mb-0">Detalles del Incidente</h2>
        </div>
        <div class="card-body">
            <h4 class="card-subtitle mb-2 text-muted">{{ incidente.nombre_incid }}</h4>
            <p><strong>Fecha:</strong> {{ incidente.fecha_incid|date:"d/m/Y" }}</p>
            <p><strong>Tipo:</strong> {{ incidente.tipo_incid }}</p>
            <p><strong>Descripción:</strong></p>
            <p>{{ incidente.descripcion_incid }}</p>
            <p><strong>Estado:</strong>
                {% if incidente.estado_incid %}
                <span class="badge bg-success">Activo</span>
                {% else %}
                <span class="badge bg-secondary">Cerrado</span>
                {% endif %}
            </p>
        </div>
    </div>

    <form action="{% url 'aplicar_sancion_masiva' incidente.id %}" id="box-det-incidente" method="post">
        {% csrf_token %}
        <div class="card shadow fondo-semi">
            <div class="card-header">
                <h3 class="card-title mb-0">Empleados Involucrados</h3>
            </div>
            <div class="card-body">
                {% if involucrados %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>
                                    <input class="form-check-input" type="checkbox" id="seleccionar-todos">
                                </th>
                                <th>Empleado</th>
                                <th>Observaciones de Registro</th>
                                <th>Estado Sanción</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for involucrado in involucrados %}
                            <tr>
                                <td>
                                    {% if not involucrado.ya_sancionado %}
                                    <input class="form-check-input" type="checkbox" name="involucrados_a_sancionar"
                                        value="{{ involucrado.id }}">
                                    {% endif %}
                                </td>
                                <td>{{ involucrado.id_empl.nombre }} {{ involucrado.id_empl.apellido }}</td>
                                <td>{{ involucrado.observaciones|default:"Sin observaciones." }}</td>
                                <td>
                                    {% if involucrado.ya_sancionado %}
                                    <span class="badge bg-warning text-dark">Sancionado</span>
                                    {% else %}
                                    <span class="badge bg-light text-dark">Pendiente</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="#" class="btn btn-sm btn-outline-info">Ver/Añadir Descargo</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No hay empleados asociados a este incidente.</p>
                {% endif %}
            </div>
            <div class="card-footer">
                <h4 class="mb-3">Aplicar Sanción a Empleados Seleccionados</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ sancion_form.id_sancion.id_for_label }}" class="form-label">{{
                            sancion_form.id_sancion.label }}</label>
                        {{ sancion_form.id_sancion }}
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="{{ sancion_form.fecha_inicio.id_for_label }}" class="form-label">{{
                            sancion_form.fecha_inicio.label }}</label>
                        {{ sancion_form.fecha_inicio }}
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="{{ sancion_form.fecha_fin.id_for_label }}" class="form-label">{{
                            sancion_form.fecha_fin.label }}</label>
                        {{ sancion_form.fecha_fin }}
                    </div>
                </div>
                <div class="mb-3">
                    <label for="{{ sancion_form.motivo.id_for_label }}" class="form-label">{{ sancion_form.motivo.label
                        }}</label>
                    {{ sancion_form.motivo }}
                </div>
                <button type="submit" class="btn btn-danger">Aplicar Sanción a Seleccionados</button>
            </div>
        </div>
    </form>
</div>

<script>
    document.getElementById('seleccionar-todos').addEventListener('click', function (event) {
        var checkboxes = document.querySelectorAll('input[name="involucrados_a_sancionar"]');
        for (var checkbox of checkboxes) {
            checkbox.checked = event.target.checked;
        }
    });
</script>
{% endblock %}